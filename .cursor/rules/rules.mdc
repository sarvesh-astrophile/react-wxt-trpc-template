---
alwaysApply: true
---
You are an expert AI programming assistant focused on clear, readable TypeScript for React WXT Chrome Extensions.

My stack: React 19 + WXT + TypeScript + tRPC (v10 via trpc-chrome) + SuperJSON + TailwindCSS + Shadcn + Biome + Bun

Core conventions:
- `src/types/` - TypeScript definitions
- `src/trpc/routers/` - tRPC procedures  
- `src/lib/` - Shared utilities & Chrome API wrappers
- `src/components/` - Reusable React components
- `entrypoints/popup/_components/` - Popup-specific components
- Use tRPC for type-safe communication between extension components
- Use Shadcn for UI components
- Use Bun as package manager
- Chrome extension manifest v3 best practices
- Always validate inputs and handle async operations properly
- Implement loading states and error boundaries
- Keep code DRY and well-structured

# Project Structure Guide

## Overview
This document outlines the efficient project structure for the React WXT Chrome Extension with TypeScript, tRPC, and modern web extension APIs.

## Root Structure
```
simple-chrome-extension-wxt/
â”œâ”€â”€ .cursor/                    # Cursor IDE configuration
â”œâ”€â”€ .env.example               # Environment variables template
â”œâ”€â”€ .gitignore                # Git ignore rules
â”œâ”€â”€ .output/                  # WXT build output directory
â”œâ”€â”€ biome.jsonc               # Biome configuration for linting/formatting
â”œâ”€â”€ bun.lock                  # Bun lock file
â”œâ”€â”€ package.json              # Dependencies and scripts
â”œâ”€â”€ README.md                 # Project documentation
â”œâ”€â”€ tasks.md                  # Development tasks
â”œâ”€â”€ tsconfig.json             # TypeScript configuration
â”œâ”€â”€ wxt.config.ts             # WXT configuration
â”œâ”€â”€ assets/                   # Source assets (React SVGs, etc.)
â”œâ”€â”€ entrypoints/              # Extension entry points
â”œâ”€â”€ public/                   # Static assets for extension
â””â”€â”€ src/                      # Shared source code
```

## Entry Points Structure (`entrypoints/`)

### Extension Entry Points
WXT uses file-based routing for extension entry points:

```
entrypoints/
â”œâ”€â”€ background.ts             # Service worker/background script
â”œâ”€â”€ content.ts               # Content script for web page injection
â”œâ”€â”€ popup/                   # Extension popup UI
â”‚   â”œâ”€â”€ index.html          # Popup HTML entry
â”‚   â”œâ”€â”€ main.tsx            # Popup React app entry
â”‚   â”œâ”€â”€ App.tsx             # Main popup React component
â”‚   â”œâ”€â”€ _components/        # Popup-specific components
â”‚   â”œâ”€â”€ App.css             # Popup-specific styles
â”‚   â””â”€â”€ style.css           # Global popup styles
â””â”€â”€ options/                 # Extension options page (optional)
    â”œâ”€â”€ index.html
    â”œâ”€â”€ main.tsx
    â””â”€â”€ App.tsx
```

----
## Source Code Structure (`src/`)

### Shared Components & Utilities
```
src/
â”œâ”€â”€ components/              # Reusable React components
â”‚   â”œâ”€â”€ ui/                  # Generic UI components
â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”œâ”€â”€ Input.tsx
â”‚   â”‚   â””â”€â”€ Card.tsx
â”‚   â””â”€â”€ common/              # Extension-specific components
â”‚       â”œâ”€â”€ ExtensionIcon.tsx
â”‚       â””â”€â”€ StatusIndicator.tsx
â”œâ”€â”€ hooks/                   # Custom React hooks
â”‚   â”œâ”€â”€ useStorage.ts        # Chrome storage hook
â”‚   â”œâ”€â”€ useTabs.ts          # Chrome tabs API hook
â”‚   â””â”€â”€ useTrpc.ts          # tRPC client hook for extension (optional)
â”œâ”€â”€ lib/                     # Shared utilities and helpers
â”‚   â”œâ”€â”€ storage.ts           # Chrome storage utilities
â”‚   â”œâ”€â”€ messaging.ts         # Extension messaging system
â”‚   â””â”€â”€ constants.ts         # Extension constants
â”œâ”€â”€ types/                   # TypeScript type definitions
â”‚   â”œâ”€â”€ chrome.d.ts        # Chrome extension API types
â”‚   â”œâ”€â”€ extension.ts       # Extension-specific types
â”‚   â””â”€â”€ trpc.ts            # tRPC shared types
â””â”€â”€ styles/                  # Global styles
    â””â”€â”€ globals.css         # TailwindCSS imports
```

### tRPC Integration Structure
```
src/trpc/
â”œâ”€â”€ client.ts               # tRPC client setup for extension
â”œâ”€â”€ router.ts               # Root app router combining feature routers
â”œâ”€â”€ routers/                # tRPC procedure definitions
â”‚   â”œâ”€â”€ storage.ts         # Storage-related procedures
â”‚   â”œâ”€â”€ tabs.ts            # Browser tab procedures
â”‚   â””â”€â”€ extension.ts       # Extension management procedures
â””â”€â”€ shared.ts              # Shared types between client/server
```

## Directory Conventions

### `entrypoints/popup/`
- **Purpose**: Extension popup interface (the UI when clicking extension icon)
- **Naming**: kebab-case for files, PascalCase for React components
- **Structure**: Standard React app structure with TypeScript

### `entrypoints/content.ts`
- **Purpose**: Content script that runs on web pages
- **Functionality**: DOM manipulation, communication with background
- **Naming**: camelCase for functions, PascalCase for classes

### `entrypoints/background.ts`
- **Purpose**: Service worker for extension lifecycle and background tasks
- **Functionality**: Message handling, storage management, tab management
- **Naming**: camelCase for functions, PascalCase for classes

### `src/components/`
- **Purpose**: Reusable React components shared across extension UI
- **Structure**: Organized by feature/domain
- **Naming**: PascalCase for components, camelCase for utilities

### `public/`
- **Purpose**: Static assets for extension (icons, manifest)
- **Content**: Extension icons, manifest.json (generated by WXT)
- **Structure**: Organized by asset type
```
public/
â”œâ”€â”€ icon/
â”‚   â”œâ”€â”€ 16.png
â”‚   â”œâ”€â”€ 32.png
â”‚   â”œâ”€â”€ 48.png
â”‚   â”œâ”€â”€ 96.png
â”‚   â””â”€â”€ 128.png
â””â”€â”€ wxt.svg                  # WXT logo
```

## File Naming Conventions

### TypeScript Files
- **Components**: `PascalCase.tsx` (e.g., `PopupApp.tsx`)
- **Hooks**: `camelCase.ts` (e.g., `useStorage.ts`)
- **Entry Points**: `kebab-case.ts` (e.g., `background.ts`, `content.ts`)
- **Utilities**: `camelCase.ts` (e.g., `storage.ts`)

### Configuration Files
- **JSON**: `kebab-case.json` (e.g., `biome.jsonc`)
- **TS Config**: `camelCase.ts` (e.g., `wxt.config.ts`)

## Module Organization

### Feature-Based Structure
Organize extension features into logical domains:

```
src/
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ bookmarks/           # Bookmark management
â”‚   â”œâ”€â”€ history/             # Browser history integration
â”‚   â”œâ”€â”€ tabs/                # Tab management
â”‚   â””â”€â”€ settings/            # Extension settings
```

### Chrome Extension APIs
Organize by Chrome extension APIs:

```
src/
â”œâ”€â”€ apis/
â”‚   â”œâ”€â”€ storage/             # Chrome storage API wrapper
â”‚   â”œâ”€â”€ tabs/               # Chrome tabs API wrapper
â”‚   â”œâ”€â”€ runtime/            # Chrome runtime API wrapper
â”‚   â””â”€â”€ messaging/          # Extension messaging system
```

## Best Practices

### Component Organization
- Keep popup components in `entrypoints/popup/`
- Share common components in `src/components/`
- Use feature-based organization for complex features
- Implement proper TypeScript types for all props

### Extension Architecture
- **Background Script**: Handle extension lifecycle, storage, cross-origin requests
- **Content Script**: Interact with web pages, send messages to background
- **Popup**: User interface for quick actions
- **Options Page**: Extension settings (if needed)

### tRPC Integration
- Use tRPC v10 for type-safe communication between popup/content and background via `trpc-chrome`
- Background exposes the handler using `createChromeHandler({ router: appRouter, createContext: () => ({}) })`
- Client created with `createTRPCProxyClient({ links: [chromeLink({ port: chrome.runtime.connect() })], transformer: superjson })`
- Use SuperJSON as the transformer; set it on the client and in your server/router init
- Implement procedures with Zod validation; keep routers in `src/trpc/routers/`
- Share `AppRouter` type from `src/trpc/router.ts`
- Optional: Use React Query in popup for caching

### Storage Management
- Use Chrome storage API for persistent data
- Implement proper type safety for storage operations
- Use tRPC procedures for complex storage operations
- Handle storage permissions properly

### Message Passing
- Implement proper message types for extension communication
- Use tRPC for type-safe message passing
- Handle async operations correctly
- Implement error handling for all message types

## Technology Stack Integration

### WXT Framework
- **Purpose**: Modern web extension development framework
- **Features**: TypeScript support, HMR, build optimization
- **Configuration**: `wxt.config.ts` for build settings

### React Integration
- **Purpose**: Modern UI development in extension popup
- **Features**: Hooks, context, state management
- **Structure**: Standard React patterns within extension constraints

### tRPC Integration
- **Purpose**: Type-safe API layer for extension communication
- **Features**: End-to-end type safety, automatic inference
- **Usage**: Between popup, content script, and background

### TypeScript Configuration
- **Purpose**: Full type safety across extension
- **Features**: Chrome extension types, strict mode
- **Configuration**: `tsconfig.json` with extension-specific types (include `"types": ["chrome"]`)

## Build Output Structure
```
.output/
â”œâ”€â”€ chrome-mv3/
â”‚   â”œâ”€â”€ manifest.json        # Generated extension manifest
â”‚   â”œâ”€â”€ popup.html          # Built popup
â”‚   â”œâ”€â”€ assets/             # Built assets
â”‚   â””â”€â”€ icons/              # Copied icons
â””â”€â”€ [browser]-mv3/         # Other browser targets
```

## Development Workflow
1. **Development**: `wxt` - Start development server with HMR
2. **Build**: `wxt build` - Build extension for production
3. **Preview**: `wxt preview` - Preview built extension
4. **Zip**: `wxt zip` - Create extension package for store submission

---
alwaysApply: true
---
# Technology Stack Guide

## Core Stack
- **React 19**: UI library for popup/options
- **TypeScript 5.x**: Type-safe development
- **WXT**: Extension development framework
- **tRPC v10 + trpc-chrome**: Type-safe API layer for extension messaging
- **SuperJSON**: Data transformer for tRPC
- **TailwindCSS**: Utility-first styling
- **Shadcn**: UI components
- **Biome**: Linting/formatting
- **Bun**: Package manager

## Extension Architecture
- **Manifest V3**: Modern Chrome extension format
- **Background**: Service worker (`background.ts`)
- **Content**: Page injection (`content.ts`)
- **Popup**: React-based UI (`entrypoints/popup/`)

## Key APIs
- **Storage API**: `chrome.storage.local/sync`
- **Tabs API**: Tab management
- **Runtime API**: Message passing & lifecycle

## Development Tools
- **Vite**: Build system via WXT
- **Vitest**: Unit testing
- **React Query**: Data fetching & caching
- **Environment**: `.env` files for configuration

## Browser Targets
- **Chrome 88+** (primary)
- **Firefox 109+** (secondary)
- **Safari 14+** (future)

## Performance
- **Bundle size**: <1MB target
- **Memory**: Efficient service worker lifecycle
- **Optimization**: Tree shaking, code splitting

## Security
- **CSP**: Strict content security policy
- **Permissions**: Minimal required permissions
- **Validation**: Input validation & sanitization

## Deployment
- **Chrome Web Store**: `wxt zip` packaging
- **Firefox Add-ons**: Cross-browser validation

----

# Task Management Rules

## ðŸ“‹ Core Rules for tasks.md Maintenance

### 1. **Status Updates**
- Update task status in both detailed section AND summary table
- Use: âœ… completed | ðŸ”„ in-progress | â­• pending | âŒ blocked
- Recalculate dashboard metrics after each change

### 2. **Dashboard Maintenance**
- **Progress Tracking**: Update percentages and visual progress bars
- **Next Recommended Task**: Identify logical next task based on dependencies
- **Quick Stats**: Keep task counts and assignment distribution current

### 3. **Dependency Management**
- When task completes: check dependent tasks and update status if unblocked
- Verify no circular dependencies exist
- Update "Tasks ready to work on" count after dependency changes

### 4. **Quality Assurance**
- Verify status consistency across all sections
- Ensure mathematical accuracy in progress calculations
- Validate dependency references are valid task IDs
- Check next recommended task makes logical sense

### 5. **Automation Protocol**
Every task status change triggers:
1. Update detailed section + summary table
2. Recalculate dashboard metrics
3. Check dependent tasks
4. Update next recommended task
5. Verify critical path accuracy
